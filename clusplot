#!/bin/bash
datafile="${1}.dataset"
clusfile="${1}.${2}"
statfile="${1}.${2}.stats"
# extract title from the first line of the cluster file in the form "# TITLE(...)"
title=$(sed '1q;d' $clusfile | tr '()' ' ' | awk '{ print $2 }')
silhouette=($(sed '5q;d' $statfile))
gnuplot -p <<- EOP
    # terminal
    set terminal png size 800,800
    set size square
    set output '${clusfile}.png'
    
    # colors
    set palette defined ( \
        0 '#222222',\
        1 '#377EB8',\
        2 '#4DAF4A',\
        3 '#984EA3',\
        4 '#FF7F00',\
        5 '#FFFF33',\
        6 '#A65628',\
        7 '#F781BF',\
        8 '#E41A1C')
    unset colorbox
        
    # title and axes
    set title 'Clusters - ${title}' font 'sans, 24'
    unset xlabel
    set xrange [-1:1]
    set xtics font 'sans, 16'
    unset ylabel
    set yrange [-1:1]
    set ytics font 'sans, 16'
    
    # styles
    set style line 1 linecolor palette pointtype 7 pointsize 1.2
    
    # plot
    # set label "Compactness: ${silhouette[1]}" at -0.98, -0.87 font 'monospace, 9'
    # set label " Separation: ${silhouette[2]}" at -0.35, -0.87 font 'monospace, 9'
    # set label "      Noise: ${silhouette[0]}" at -0.98, -0.93 font 'monospace, 9'
    # set label " Silhouette: ${silhouette[3]}" at -0.35, -0.93 font 'monospace, 9'
    plot '< paste ${datafile} ${clusfile}' using 2:3:5 with points notitle ls 1;
EOP